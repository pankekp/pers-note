# 网络请求过程

---

## 1. 获取IP

DHCP（一般会同时配置默认网关的IP）

## 2. 获取域名

DNS解析

## 3. 建立连接

TCP -> HTTP(S)，HTTP 协议在 TCP 连接的 ESTABLISH 阶段建立

## 4. 传输网络包

1. 浏览器或 APP 将 HTTP 包交给传输层
2. 通过 ARP 获取默认网关的 MAC，并将数据包发送至默认网关
3. 默认网关收到包后通过 ARP 拿到下一跳的路由 MAC 地址并发送，这个过程中可能会经历 NAT 路由
4. 到达最后一跳时路由将包发送至与包内目标 IP 同一网段的局域网段

整个过程中需要明确的：

* 数据包有四部分构成：源 MAC / 目标 MAC / 源 IP / 目标 IP，其中 IP 地址始终不变，而 MAC 地址在各个局域网之间都会变化
* 路由的每个出口对应一个网段，路由会根据路由规则来判断这个具有目标 IP 的数据包应该被转发至哪个出口（网段），如果到达同一网段则路由结束，通过 ARP 获取目标 MAC 即可

# OSTEP 读书笔记——磁盘驱动器

---

## 1. 概述

磁盘驱动器由若干个扇区（sector）组成，每个扇区包好 512bytes，编号从 0 ~ n-1。大多数文件系统一次读写操作 4KB 或以上的数据，但是硬盘厂商只保证每个扇区的读写是原子性的

两个假设：

* 访问相邻的两个扇区比访问分开的两个扇区快
* 访问连续的扇区是最快的访问模式

## 2. 结构 & 细节

**磁道**：盘面上的圆形带状区域，一个磁盘有多个磁道
**扇区**：磁道上的弧段，是最小的物理存储单位
**旋转时间**：磁道上待读取的扇区旋转到读取位置的等待时间
**寻道时间**：磁头移动到对应磁道上的时间
**数据传输时间**：从盘面上读写数据的时间

磁道斜进：假设需要读取连续 18 个扇区的数据，前一个磁道的全部 16 个扇区已经读完，切换磁道后这个磁道的起始扇区已经转过了磁头，则不得不等待起始扇区下一次经过磁头。如果每个磁道的起始扇区位置不对齐，而是相差几个扇区的位置，那么切换磁道后只需经过几个位置就可以读取到起始扇区位置。

多区域磁盘驱动器：由于越靠近外围的磁道拥有的扇区越多，所以将磁盘划分为若干个区域，每个区域所有磁道扇区的总和相同，越靠近外围的区域总扇区越多。

磁盘缓存：磁盘缓存是驱动器读写数据时使用到的很小一块内存区域，目的是减少 I/O 次数如在读取扇区时将此磁道上的所有扇区都读取到缓存中，或在写数据时，将数据先写入缓存，然后一次写入磁盘中。在写数据时有两种写入策略：

* write back caching：将数据写入缓存即认为写入完成。若应用程序需要按照一定顺序将数据写入磁盘，那么此策略就会到导致一些问题
* write through：将数据写入磁盘才确认写入完成
